<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Material Price Calculator</title>
<style>
body{font-family:system-ui,sans-serif;padding:20px;background:#f9f9f9;}
h2{text-align:center;}
input,button,select{width:100%;padding:10px;margin:8px 0;font-size:16px;}
#orders table{width:100%;border-collapse:collapse;margin-top:10px;}
#orders th,#orders td{border:1px solid #ccc;padding:8px;text-align:center;}
#error{color:red;font-weight:bold;margin-top:5px;}
#result{margin-top:15px;font-weight:bold;font-size:20px;color:#007700;}
</style>
</head>
<body>

<h2>Material Price Calculator</h2>

<label>Item name:</label>
<input id="itemInput" placeholder="e.g. BX2/12">

<label>Quantity:</label>
<input id="qtyInput" type="number" value="1" min="1">

<button onclick="addItem()">Add Item</button>
<button onclick="clearOrders()">Clear Orders</button>

<div id="error"></div>

<div id="orders">
  <table>
    <thead>
      <tr>
        <th>Item</th><th>Quantity</th><th>Price</th><th>Subtotal</th>
      </tr>
    </thead>
    <tbody id="ordersBody"></tbody>
  </table>
</div>

<div id="result"></div>

<script>
let orders = [];
let data = {};

function normalize(str){return str.replace(/\s+/g,'').toLowerCase();}

// Загружаем JSON
async function loadData(){
  const res = await fetch('data.json');
  data = await res.json();
}

function renderOrders(){
  const ordersBody = document.getElementById("ordersBody");
  ordersBody.innerHTML = "";
  let total = 0;
  orders.forEach(o=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${o.item}</td><td>${o.qty}</td><td>${o.price}</td><td>${o.subtotal}</td>`;
    ordersBody.appendChild(tr);
    total += o.subtotal;
  });
  document.getElementById("result").textContent = `Total: $${total.toFixed(2)}`;
}

function clearOrders(){
  orders=[];
  renderOrders();
  document.getElementById("error").textContent="";
}

function addItem(){
  const item = document.getElementById("itemInput").value.trim();
  const qty = parseFloat(document.getElementById("qtyInput").value);
  const errorDiv = document.getElementById("error");
  errorDiv.textContent="";

  if(!item || qty<=0){errorDiv.textContent="Please enter valid item and quantity"; return;}

  // Поиск во всех категориях
  let found = null;
  for(const cat in data){
    found = data[cat].find(i=>normalize(i.item)===normalize(item));
    if(found) break;
  }

  if(!found){errorDiv.textContent="Error: incorrect name"; return;}

  const subtotal = found.price * qty;
  orders.push({item, qty, price:found.price, subtotal});
  renderOrders();

  document.getElementById("itemInput").value="";
  document.getElementById("qtyInput").value=1;
}

loadData();
</script>
</body>
</html>
