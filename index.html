<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Material Price Calculator</title>
<style>
body{font-family:system-ui,sans-serif;padding:20px;background:#fafafa;}
input,button,select{padding:8px;margin:5px;}
#result{margin-top:10px;font-size:18px;font-weight:bold;}
</style>
</head>
<body>

<h2>Material Price Calculator</h2>

<label>Category:</label>
<select id="sheetSelect"></select><br>

<label>Item:</label>
<input id="itemInput" placeholder="e.g. BX2/12"><br>

<label>Quantity:</label>
<input id="qtyInput" type="number" value="1" min="1"><br>

<button onclick="addItem()">Add Item</button>
<button onclick="clearList()">Clear</button>

<table border="1" cellpadding="5" id="list" style="margin-top:10px;">
<thead><tr><th>Item</th><th>Qty</th><th>Price</th><th>Subtotal</th></tr></thead>
<tbody></tbody>
</table>

<div id="result"></div>

<script>
const SHEETS_API = "YOUR_WEB_APP_URL"; // your deployed Apps Script URL
let data = {};
let items = [];
const normalize = s => s.replace(/\s+/g,'').toLowerCase();

async function fetchData(){
  const res = await fetch(SHEETS_API);
  data = await res.json();
  const select = document.getElementById("sheetSelect");
  select.innerHTML = Object.keys(data).map(n => `<option>${n}</option>`).join('');
  console.log("Data refreshed", data);
}
setInterval(fetchData, 10000); // auto-refresh every 10s
fetchData();

function addItem(){
  const sheet = document.getElementById("sheetSelect").value;
  const name = document.getElementById("itemInput").value.trim();
  const qty = parseFloat(document.getElementById("qtyInput").value);
  if(!name || qty<=0) return;
  const found = data[sheet]?.find(i => normalize(i.item)===normalize(name));
  if(!found){alert("Item not found!");return;}
  const price = found.price;
  const subtotal = (price * qty).toFixed(2);
  items.push({name, qty, price, subtotal});
  render();
}
function render(){
  const tbody=document.querySelector("#list tbody");
  tbody.innerHTML="";
  let total=0;
  items.forEach(i=>{
    total+=parseFloat(i.subtotal);
    tbody.innerHTML+=`<tr><td>${i.name}</td><td>${i.qty}</td><td>$${i.price.toFixed(2)}</td><td>$${i.subtotal}</td></tr>`;
  });
  document.getElementById("result").innerText=`Total: $${total.toFixed(2)}`;
}
function clearList(){items=[];render();}
</script>

</body>
</html>
